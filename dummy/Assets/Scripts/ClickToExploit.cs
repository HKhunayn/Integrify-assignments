using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class ClickToExploit : MonoBehaviour
{
    // Start is called before the first frame update
    [SerializeField] GameObject explosionEffect;
    [SerializeField] float explosionPower=1000f;
    void Start()
    {
        
    }

    // Update is called once per frame
    void Update()
    {
        if (Input.GetMouseButtonDown(0))
        {
            Vector3 mousePos = Input.mousePosition;
            Vector3 dir = Camera.main.ScreenToWorldPoint(new Vector3(mousePos.x, mousePos.y, 5)) - Camera.main.transform.position;
            dir = dir.normalized;
            RaycastHit hit;
            Physics.Raycast(Camera.main.transform.position, dir, out hit);

            if (hit.collider == null)
                return;

            Vector3 pos = hit.point;

            GameObject g = new GameObject();
            g.transform.position = pos;
            var colls =Physics.OverlapSphere(pos, 2);
            foreach(var coll in colls)
            {
                Rigidbody rb;
                if (coll.TryGetComponent<Rigidbody>(out rb)) 
                {
                    rb.AddExplosionForce(explosionPower, pos, 2);
                    
                }
                    
            }
            StartCoroutine(IDoTheExplosionEffect(pos));
        }
    }


    IEnumerator IDoTheExplosionEffect(Vector3 pos) 
    {
        GameObject g = Instantiate(explosionEffect, pos, Quaternion.identity);
        yield return new WaitForSeconds(1);
        Destroy(g);
    }
}
